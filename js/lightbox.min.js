const projectImages = {
    sunny_side_up: [
        "assets/asset_001_001.jpg",
        "assets/asset_001_002.jpg",
        "assets/asset_001_003.jpg",
        "assets/asset_001_004.jpg",
        "assets/asset_001_005.jpg",
        "assets/asset_001_006.jpg",
        "assets/asset_001_007.jpg"
    ],
    urban_fitness: [
        "assets/asset_002_001.jpg",
        "assets/asset_002_002.jpg",
        "assets/asset_002_003.jpg",
        "assets/asset_002_004.jpg",
        "assets/asset_002_005.jpg"
    ],
    furka: [
        "assets/asset_003_001.jpg",
        "assets/asset_003_002.jpg",
        "assets/asset_003_003.jpg",
        "assets/asset_003_004.jpg",
        "assets/asset_003_005.jpg"
    ],
    neumuehle: [
        "assets/asset_004_001.jpg",
        "assets/asset_004_002.jpg",
        "assets/asset_004_003.jpg",
        "assets/asset_004_004.jpg",
        "assets/asset_004_005.jpg"
    ],
    cupcake: [
        "assets/asset_005_001.jpg",
        "assets/asset_005_002.jpg",
        "assets/asset_005_003.gif",
        "assets/asset_005_004.jpg",
        "assets/asset_005_005.jpg"
    ]
};

const lb = document.querySelector(".lightbox");
const lbSrc = document.querySelector(".lightboxSrc");
const lbCount = document.querySelector(".lightboxCount");
const lbClose = document.querySelector(".lightboxClose");
const lbPrev = document.querySelector(".lightboxPrev");
const lbNext = document.querySelector(".lightboxNext");

let currentProject = null;
let currentIndex = 0;

function updateImage() {
    if (!currentProject) return;
    const arr = projectImages[currentProject];
    lbSrc.src = arr[currentIndex];
    lbCount.textContent = (currentIndex + 1) + " / " + arr.length;
};

function openLightbox(project, startIndex = 0) {
    currentProject = project;
    currentIndex = startIndex;
    updateImage();
    lb.style.display = "flex";
    document.body.style.overflow = "hidden";
    addEvents();
};

function closeLightbox() {
    lb.style.display = "none";
    lbSrc.src = "";
    document.body.style.overflow = "auto";
    removeEvents();
};

function prevImage() {
    const arr = projectImages[currentProject];
    currentIndex = (currentIndex - 1 + arr.length) % arr.length;
    updateImage();
};

function nextImage() {
    const arr = projectImages[currentProject];
    currentIndex = (currentIndex + 1) % arr.length;
    updateImage();
};

function handleKeydown(event) {
    switch (event.key) {
        case "ArrowLeft":
            event.preventDefault();
            prevImage();
            break;
        case "ArrowRight":
        case " ":
            event.preventDefault();
            nextImage();
            break;
        case "Escape":
            event.preventDefault();
            closeLightbox();
            break;
    }
};

function handleClickOutside(e) {
    if (e.target === lb) closeLightbox();
};

const eventBindings = [
    { element: document, event: "keydown", handler: handleKeydown },
    { element: lbClose, event: "click", handler: closeLightbox },
    { element: lbPrev, event: "click", handler: prevImage },
    { element: lbNext, event: "click", handler: nextImage },
    { element: lb, event: "click", handler: handleClickOutside }
];

function addEvents() {
    eventBindings.forEach(({element, event, handler}) => {
        element.addEventListener(event, handler);
    });
};

function removeEvents() {
    eventBindings.forEach(({element, event, handler}) => {
        element.removeEventListener(event, handler);
    });
};

document.querySelectorAll(".viewProject").forEach(link => {
    link.addEventListener("click", e => {
        e.preventDefault();
        const project = link.dataset.project;
        openLightbox(project, 0);
    });
});